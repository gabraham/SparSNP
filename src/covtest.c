#include <stdlib.h>
#include <stdio.h>
#include "matrix.h"

int main(void)
{
   int i;
   int n = 50, p = 10;
   int p2 = p * p;
   double mse = 0;

   double x[500] = {
	 -0.23, -2.16, -1.23, 0.69, -0.45, -0.52, -1.21, 1.3, 0.58,
	 0.3, -0.63, 0.03, 0.62, -0.7, 0.24, -1.09, -0.56, -1.77,
	 -2.96, 0.3, -0.35, -0.72, 0.88, 0.65, 1.77, 1.9, 1.11, -0.22,
	 0.61, -1.18, -1.2, -0.24, 1.01, 0.33, -0.67, 0.75, -1.67,
	 0.22, -0.38, 1.78, 0.96, 0.31, 1.63, 2.21, 1.38, 0.73, 0.9,
	 -0.4, 0.01, 0.67, 0.87, 2.22, -0.67, 0.24, 0.02, 0.41, 1.32,
	 2.07, 0.56, -0.56, 0.04, -1.46, 1.22, 0.75, -0.39, -0.56,
	 -0.19, -1.42, -0.21, 0.91, -2, -1.35, 0.74, -1.25, -0.09,
	 1.25, 0.31, -0.94, -0.26, -0.69, -0.14, -0.91, -0.42, -0.15,
	 -0.14, -0.16, -0.61, -0.28, -0.88, -0.76, 0.75, -1.21, -0.72,
	 1.27, -0.82, 0.39, -2.63, -0.32, 0.76, -1.53, 0.3, -1.21,
	 0.74, 1.32, 1.74, -0.45, -1.78, 1.58, -0.92, 1.61, -0.29,
	 1.35, -0.95, 0.59, 0.7, 0.4, 0.52, 1.28, -0.11, -0.1, 0.44,
	 -0.19, 1.33, -0.04, -1.34, -1.43, -1.18, 2.21, -1.05, -1.02,
	 -0.24, 1.5, 1.41, -1.1, 0.06, 1.24, 0.1, -0.36, 0.27, -0.2,
	 1.06, 1.13, -0.8, -0.58, -0.58, -0.4, -0.66, 0.39, -0.41, 1,
	 -0.54, -0.55, -1.47, 0.33, 0.48, 0.66, 0.07, -0.46, 2.14,
	 0.25, 0.06, -0.44, 2.24, -0.36, -0.94, 0.65, 1.12, -0.17,
	 -0.78, 0.57, -1.17, -1.25, -0.88, -0.92, 0.04, 1.32, -1.51,
	 -0.39, 1.48, 0.7, -0.56, -0.87, -0.07, -1.57, -0.38, -0.94,
	 0.73, 0.39, -0.51, -1.12, 0.53, -0.59, -0.79, -0.59, -0.05,
	 1.72, -0.53, -0.35, -0.43, 0.85, -0.94, -0.99, -0.31, -0.2,
	 -0.49, 0.54, 0.02, -0.47, -1.14, 0.34, 1.22, 0.85, -1.98,
	 0.46, -0.06, 0.72, -1.4, -0.04, 2.08, 0.89, -1.55, 1.77,
	 -0.94, -1.11, -1.32, -0.54, -1.81, -0.38, 1.19, 0.74, -0.73,
	 1.34, 1.78, -0.8, -1.17, 0.54, -1.42, -1.22, 0.6, 0.47,
	 -0.87, -1.19, -0.35, -1.24, -0.06, 0.42, -0.35, 2.02, 0.28,
	 0.41, 2.27, -0.83, 0.85, -0.4, -0.63, -1.07, 0.86, 0.88,
	 1.07, 0.92, -0.72, 0.9, -0.73, -0.94, 2.21, -1.72, -0.11,
	 0.07, 1.63, 0, 0.94, 0.4, 0.93, -0.4, 0.63, -1.35, -2.14,
	 0.12, -0.48, -0.27, -0.2, 0.11, 1.51, -0.5, 0.24, -0.05,
	 -1.37, 0.59, 0.51, -0.19, -0.38, 1.04, 2.27, 0.77, -0.01,
	 0.2, 1.01, -0.19, 1.21, 1.02, 0.89, 0.99, 1.17, 0.05, 0.01,
	 -2.03, -0.66, -0.36, 0.23, -1.62, 1.49, -0.91, -0.89, -0.48,
	 0.01, -1.06, 0.06, 0.62, -1.23, -1.85, -1.61, 0.8, 2.56,
	 1.82, -1.62, -1.97, 0.22, 1.44, 0.18, 1.63, -0.62, 1.76,
	 -0.04, -1.25, 0.27, -0.75, -0.97, 2.08, 0.17, -0.87, -1.2,
	 0.1, -2.24, -0.29, 0.05, -0.53, 3.22, -0.13, -1.95, 0.83,
	 -0.24, -0.79, -0.83, 0.41, -0.27, -1.83, -0.57, -2.49, 0.78,
	 -0.21, -1.35, -0.17, 0.42, -0.42, -0.42, -1.13, 0.37, 0.36,
	 0.73, 2.17, -1.19, -0.66, -1.46, -1.01, -0.71, -0.01, 1.01,
	 -0.2, 1.99, 0.46, 1.25, 0.27, -1.17, 1.36, -0.48, -0.4,
	 -0.84, 1.48, -0.36, 0.16, -1.48, 1.49, 0.83, -1.5, -1.75,
	 0.22, 0.74, -0.56, 0.72, 0.8, -1.71, -2.14, -0.2, -1.87,
	 0.13, 0.2, -0.34, -0.05, -0.27, -0.82, 1.67, 1.33, -1.84,
	 -1.56, 0.7, -0.15, 1, 1.13, 0.8, 0.24, -0.29, -1.11, -0.86,
	 -0.96, -1.22, 1.34, 1.57, -0.84, 0.84, -0.45, 0.07, -2.18,
	 0.68, -1.29, -0.75, -2.55, 2.36, 3.02, 1.08, 0.25, 0.75,
	 -0.29, 0.31, -0.07, -0.5, -0.92, -0.81, 0.29, 0.14, -1.04,
	 -1.18, -1.26, -0.27, -1.56, -1.19, -0.33, 0.05, 0.3, -1.01,
	 -0.12, 0.43, 1.98, 0.9, -0.23, -1.77, -0.32, 0.63, 0.87,
	 0.01, -0.93, -1.4, 0.53, 0.24, -0.72, 0, -0.98, -0.34, 1.71,
	 0.2, 0.73, -0.43, 1.34, -0.01, -0.21, -0.54, 0.64, 0.25,
	 -0.62, -1.03, -0.13, 1.91, -2.93, -0.07, 0.18, -0.98, -0.51,
	 1.89, 1.34, 0.67, 0.77
   };

   double S[100] = {
      1.060432, 0.0118235102040816, -0.100851755102041,
      0.310478122448980, 0.100222693877551, -0.140473632653061,
      0.00685763265306122, 0.263681714285714, 0.0332881632653061,
      -0.185045142857143, 0.0118235102040816, 1.51710465306122,
      0.147481551020408, 0.00609779591836736, 0.0107034285714286,
      0.00678138775510205, -0.0956727346938775, 0.0168807346938775,
      0.0816383673469388, 0.0196496326530612, -0.100851755102041,
      0.147481551020408, 1.34339738775510, 0.203276408163265,
      -0.133333142857143, -0.124352734693878, -0.0431315918367347,
      -0.0177430204081633, -0.189447755102041, 0.103433142857143,
      0.310478122448980, 0.00609779591836736, 0.203276408163265,
      0.865409959183673, 0.130658204081633, -0.00218302040816328,
      -0.153483591836735, 0.0196037551020408, -0.00287714285714286,
      0.153070367346939, 0.100222693877551, 0.0107034285714286,
      -0.133333142857143, 0.130658204081633, 0.724393020408163,
      0.0925709795918367, -0.0442323265306122, -0.0087655918367347,
      0.0166067346938776, -0.0522379183673469, -0.140473632653061,
      0.00678138775510205, -0.124352734693878, -0.00218302040816328,
      0.0925709795918367, 1.03089587755102, 0.0147256326530613,
      -0.340160693877551, 0.098204693877551, 0.0326963673469388,
      0.00685763265306122, -0.0956727346938775, -0.0431315918367347,
      -0.153483591836735, -0.0442323265306122, 0.0147256326530613,
      1.41097208163265, 0.147887183673469, -0.00068244897959183,
      0.0689568163265306, 0.263681714285714, 0.0168807346938775,
      -0.0177430204081633, 0.0196037551020408, -0.0087655918367347,
      -0.340160693877551, 0.147887183673469, 1.20457065306122,
      0.0603716326530612, 0.0146370204081633, 0.0332881632653061,
      0.0816383673469388, -0.189447755102041, -0.00287714285714286,
      0.0166067346938776, 0.098204693877551, -0.00068244897959183,
      0.0603716326530612, 1.02010714285714, 0.122778979591837,
      -0.185045142857143, 0.0196496326530612, 0.103433142857143,
      0.153070367346939, -0.0522379183673469, 0.0326963673469388,
      0.0689568163265306, 0.0146370204081633, 0.122778979591837,
      0.821115469387755
   };

   double P[100] = {
	 1, 0.00932174563372466, -0.0844967098176111,
	 0.324099713185799, 0.114350358626804, -0.134352576575822,
	 0.00560626464180645, 0.233304148917237, 0.0320055670590966,
	 -0.198305226543107, 0.00932174563372466, 1,
	 0.103306506752612, 0.00532174634668184, 0.0102100534677479,
	 0.00542254801317434, -0.0653914861169377, 0.0124872680702469,
	 0.0656241432259248, 0.0176053453415975, -0.0844967098176111,
	 0.103306506752612, 1, 0.188527098714345, -0.135160172647609,
	 -0.105668535706741, -0.0313280978566365, -0.0139479108613344,
	 -0.161831969441104, 0.0984816586146054, 0.324099713185799,
	 0.00532174634668184, 0.188527098714345, 1, 0.165020770845151,
	 -0.00231121022350848, -0.138896658980439, 0.0192004843790715,
	 -0.00306215794398527, 0.181584202510911, 0.114350358626804,
	 0.0102100534677479, -0.135160172647609, 0.165020770845151, 1,
	 0.107122408696110, -0.0437515500556208, -0.00938378343866464,
	 0.0193185365820945, -0.067732423746196, -0.134352576575822,
	 0.00542254801317434, -0.105668535706741,
	 -0.00231121022350848, 0.107122408696110, 1,
	 0.0122097662748563, -0.30525345497151, 0.0957639277838345,
	 0.0355377547208644, 0.00560626464180645, -0.0653914861169377,
	 -0.0313280978566365, -0.138896658980439, -0.0437515500556208,
	 0.0122097662748563, 1, 0.113437119242976,
	 -0.000568837323307882, 0.064064268987369, 0.233304148917237,
	 0.0124872680702469, -0.0139479108613344, 0.0192004843790715,
	 -0.00938378343866464, -0.30525345497151, 0.113437119242976,
	 1, 0.0544620378192654, 0.0147175127998610,
	 0.0320055670590966, 0.0656241432259248, -0.161831969441104,
	 -0.00306215794398527, 0.0193185365820945, 0.0957639277838345,
	 -0.000568837323307882, 0.0544620378192654, 1,
	 0.134152573509193, -0.198305226543107, 0.0176053453415975,
	 0.0984816586146054, 0.181584202510911, -0.067732423746196,
	 0.0355377547208644, 0.064064268987369, 0.0147175127998610,
	 0.134152573509193, 1
   };

   int G[500] = {
      1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,
      1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0,
      1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
      1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1,
      1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,
      1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1
   };

   /* cov(use="pairwise.complete.obs") */
   double S2[100] = {
      1.07768131359852, -0.0387862579281184, -0.151864617940199,
      0.259302865853659, 0.079763266384778, -0.196592857142857,
      -0.0486565656565657, 0.267032928475034, 0.0199773532668882,
      -0.237031578947368, -0.0387862579281184, 1.52402534690102,
      0.230963122923588, 0.068064756097561, -0.0144511627906977,
      0.0367978858350951, -0.100233181818182, 0.0286904183535762,
      -0.00904176829268294, 0.0314899715504979, -0.151864617940199,
      0.230963122923588, 1.41980913043478, 0.344348974358974,
      -0.201525687103594, -0.0957965156794425, -0.117758350951374,
      -0.0494357041251778, -0.27235641025641, 0.169248888888889,
      0.259302865853659, 0.068064756097561, 0.344348974358974,
      0.878968446088795, 0.139222764227642, 0.000307256097560956,
      -0.0766192799070848, -0.00149841269841271, -0.0941074898785425,
      0.231865329768271, 0.079763266384778, -0.0144511627906977,
      -0.201525687103594, 0.139222764227642, 0.676971600370028,
      -0.0387086378737541, -0.0583940909090909, -0.0519058704453441,
      -0.00538501742160279, 0.00521944444444445, -0.196592857142857,
      0.0367978858350951, -0.0957965156794425, 0.000307256097560956,
      -0.0387086378737541, 1.02223439613527, -0.00593499999999997,
      -0.409419345661451, 0.143501666666667, -0.100561587301587,
      -0.0486565656565657, -0.100233181818182, -0.117758350951374,
      -0.0766192799070848, -0.0583940909090909, -0.00593499999999997,
      1.43567016843972, 0.305466097560976, -0.0288933797909408,
      0.146194594594595, 0.267032928475034, 0.0286904183535762,
      -0.0494357041251778, -0.00149841269841271, -0.0519058704453441,
      -0.409419345661451, 0.305466097560976, 1.25894407665505,
      0.0839609523809524, 0.0724382352941176, 0.0199773532668882,
      -0.00904176829268294, -0.27235641025641, -0.0941074898785425,
      -0.00538501742160279, 0.143501666666667, -0.0288933797909408,
      0.0839609523809524, 1.11555576109937, 0.143472597597598,
      -0.237031578947368, 0.0314899715504979, 0.169248888888889,
      0.231865329768271, 0.00521944444444445, -0.100561587301587,
      0.146194594594595, 0.0724382352941176, 0.143472597597598,
      0.834823333333333
   };

   int *good = NULL;

   double *S1 = malloc(sizeof(double) * p2);
   double *P1 = malloc(sizeof(double) * p2);

   good = malloc(sizeof(int) * n * p);
   for(i = 0 ; i < n * p ; i++)
      good[i] = 1;

   /********************/
   if(!cov(x, S1, n, p))
      return EXIT_FAILURE;

   for(i = 0 ; i < p2 ; i++)
      mse += (S[i] - S1[i]) * (S[i] - S1[i]);

   printf("MSE: %.3f\n", mse);

   printf("Expected:\n");
   printmatrix(S, p, p);

   printf("Actual:\n");
   printmatrix(S1, p, p);
   printf("------------------------------\n");

   /********************/
   cov2cor(S1, P1, p);
   mse = 0;

   for(i = 0 ; i < p2 ; i++)
      mse += (P[i] - P1[i]) * (P[i] - P1[i]);

   printf("\n\nMSE: %.3f\n", mse);

   printf("Expected:\n");
   printmatrix(P, p, p);

   printf("Actual:\n");
   printmatrix(P1, p, p);
   printf("------------------------------\n");

   /********************/
   if(!covmiss(x, S1, n, p, good))
      return EXIT_FAILURE;

   mse = 0;
   for(i = 0 ; i < p2 ; i++)
      mse += (S[i] - S1[i]) * (S[i] - S1[i]);

   printf("MSE: %.3f\n", mse);

   printf("Expected:\n");
   printmatrix(S, p, p);

   printf("Actual:\n");
   printmatrix(S1, p, p);

   printf("------------------------------\n");

   /********************/
   if(!covmiss(x, S1, n, p, G))
      return EXIT_FAILURE;

   mse = 0;
   for(i = 0 ; i < p2 ; i++)
      mse += (S2[i] - S1[i]) * (S2[i] - S1[i]);

   printf("MSE: %.3f\n", mse);

   printf("Expected:\n");
   printmatrix(S2, p, p);

   printf("Actual:\n");
   printmatrix(S1, p, p);



   free(S1);
   free(P1);
   free(good);

   return EXIT_SUCCESS;
}

